package Dao;

import java.sql.*;
import java.util.ArrayList;

import Utilities.Conexao;
import Dao.Usuario;
import Dao_OLD.ConnectionFactory;

public class PreferenciaDAO {
    private static PreparedStatement pstmt = null;
    private static ResultSet rs = null;
	private Connection connection;
    public ConnectionFactory conexta;
	
	public PreferenciaDAO() {
		this.connection = new ConnectionFactory().getConnection();	
	}
	
    public void adiciona(Preferencia pref) {
		String sql = "INSERT INTO preferencias (idPreferencia, descricao) "+
                    "Values(?,?)";
		try {	
			// prepared statement para inserção		
			PreparedStatement stmt = connection.prepareStatement(sql);						
			// seta os valores
			stmt.setInt(1, pref.getIdPreferencia());
            stmt.setString(2, pref.getDescricao());
          
			// executa
			stmt.execute();
			stmt.close();
			connection.close();
			
		} catch (SQLException e) {
			throw new RuntimeException(e);
		}		
	}
    
    public static boolean update(Preferencia pref) {
        try {
        	pstmt = Conexao.getConnection().prepareStatement(
                    "Update preferencias Set idPreferencia=?, descricao=? where idPreferencia = ?");
            pstmt.setInt(1, pref.getIdPreferencia());            
            pstmt.setString(2, pref.getDescricao());
            pstmt.executeUpdate();
            pstmt.close();
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }
    
    public static boolean delete(Preferencia pref) {
        try {
            pstmt = Conexao.getConnection().prepareStatement(
                    "Delete From usuarios Where idPreferencia= ?");
            pstmt.setInt(1, pref.getIdPreferencia());
            pstmt.executeUpdate();
            pstmt.close();
            return true;
        } catch (Exception e) {
            e.printStackTrace();
            return false;
        }
    }
    
    public static ArrayList<Preferencia> getAll() {
        try {
            ArrayList<Preferencia> listAll = null;
            Preferencia pref = new Preferencia();
            pstmt = Conexao.getConnection().prepareStatement(
                    "Select * From preferencias Order By idPreferencia");
            rs = pstmt.executeQuery();
            if (rs.next()) {
                listAll = new ArrayList<Preferencia>();
                do {
                    pref = new Preferencia();
                    pref.setIdPreferencia(rs.getInt("idPreferencia"));
                    pref.setDescricao(rs.getString("descricao"));
                    listAll.add(pref);
                } while (rs.next());
            }
            rs.close();
            pstmt.close();
            return listAll;
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        }
    }
    
    public static Usuario getById(int Id) {
        try {
            Usuario usuario = null;
            pstmt = Conexao.getConnection().prepareStatement(
                    "Select * From Usuario Where CodUsuario = ?");
            pstmt.setInt(1, Id);
            rs = pstmt.executeQuery();
            if (rs.next()) {
                usuario = new Usuario();
                usuario.setIdUsuario(rs.getInt("idUsuario"));
                usuario.setSenha(rs.getString("Senha"));
                usuario.setNome(rs.getString("nome"));
                usuario.setEndereco(rs.getString("endereco"));
                usuario.setCpf(rs.getInt("cpf"));
                usuario.setNascimento(rs.getString("nascimento"));
                usuario.setPais(rs.getString("pais"));
                usuario.setCidade(rs.getString("cidade"));
                usuario.setTelefone(rs.getString("telefone"));
                usuario.setCelular(rs.getString("celular"));
                usuario.setEmail(rs.getString("email"));
                usuario.setRating(rs.getInt("rating"));
                usuario.setPergunta(rs.getString("pergunta"));
                usuario.setResposta(rs.getString("resposta"));
                usuario.setFoto(rs.getString("foto"));
            }
            rs.close();
            pstmt.close();
            return usuario;
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        }
    }
    
    public static Usuario getUserLogin(String email, String senha){
        try {
            Usuario usuario = null;
            
            pstmt = Conexao.getConnection().prepareStatement(
                    "Select * From usuarios Where email=? AND senha=?");
            pstmt.setString(1, email);
            pstmt.setString(2, senha);
            rs = pstmt.executeQuery();
            if(rs.next()){
            	usuario = new Usuario();
                usuario.setIdUsuario(rs.getInt("idUsuario"));
                usuario.setSenha(rs.getString("Senha"));
                usuario.setNome(rs.getString("nome"));
                usuario.setEndereco(rs.getString("endereco"));
                usuario.setCpf(rs.getInt("cpf"));
                usuario.setNascimento(rs.getString("nascimento"));
                usuario.setPais(rs.getString("pais"));
                usuario.setCidade(rs.getString("cidade"));
                usuario.setTelefone(rs.getString("telefone"));
                usuario.setCelular(rs.getString("celular"));
                usuario.setEmail(rs.getString("email"));
                usuario.setRating(rs.getInt("rating"));
                usuario.setPergunta(rs.getString("pergunta"));
                usuario.setResposta(rs.getString("resposta"));
                usuario.setFoto(rs.getString("foto"));
            }
            
            return usuario;
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        }        
    }
            
	public int getLast() {
		try{
			int id = 0;
			PreparedStatement stmt = this.connection.prepareStatement("SELECT MAX( idUsuario ) as idUsuario FROM usuarios");
			ResultSet rs = stmt.executeQuery();
			while (rs.next())
			id = rs.getInt("idUsuario");
			rs.close();
			stmt.close();
			return id;
		}catch (SQLException e){
		throw new RuntimeException(e);
		}
	}   
    
}